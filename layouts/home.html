{{ define "main" }}
  <article class="px-1">
    <div class="content">
      {{ .Content }}
    </div>
  </article>

  {{ $calEvents := where (where .Site.RegularPages ".Params.tags" "intersect" (slice "event-cal")) "Type" "events" }}
  {{ if $calEvents }}
  <div class="flex-grow-1 px-xl-1 mt-4">
    <h2 class="mb-3"><i class="fas fa-calendar-day me-2"></i>Upcoming Events</h2>
    {{ range $calEvents }}
      <article class="card-wrapper card">
        <a href="{{ .RelPermalink }}" class="post-preview row g-0">
          <div class="col-12">
            <div class="card-body d-flex flex-column">
              <h1 class="card-title my-2 mt-md-0">{{ .Title }}</h1>
              {{ if .Params.event_date }}
              <div class="mb-2">
                <i class="far fa-calendar fa-fw me-1"></i>
                <strong>{{ .Params.event_date }}</strong>
              </div>
              {{ end }}
              <div class="card-text content mt-0 mb-3">
                <p>{{ .Description | default .Summary | plainify | truncate 150 }}</p>
              </div>
            </div>
          </div>
        </a>
      </article>
    {{ end }}
  </div>
  {{ end }}

  {{ $posts := first 5 (where .Site.RegularPages "Type" "posts") }}
  {{ if $posts }}
  <div id="post-list" class="flex-grow-1 px-xl-1 mt-4">
    <h2 class="mb-3"><i class="fas fa-newspaper me-2"></i>Recent Posts</h2>
    {{ range $posts }}
      <article class="card-wrapper card">
        <a href="{{ .RelPermalink }}" class="post-preview row g-0 flex-md-row-reverse">
          {{ $card_body_col := "12" }}

          {{ if .Params.image }}
            {{ $src := .Params.image.path | default .Params.image }}
            {{ if not (findRE "//" $src) }}
              {{ $src = .Resources.GetMatch ( .Params.image.path | default .Params.image ) }}
              {{ $src = $src.RelPermalink }}
            {{ end }}
            {{ $alt := .Params.image.alt | default "Preview Image" | htmlEscape }}
            <div class="col-md-5">
              <img src="{{ $src }}" alt="{{ $alt }}">
            </div>
            {{ $card_body_col = "7" }}
          {{ end }}

          <div class="col-md-{{ $card_body_col }}">
            <div class="card-body d-flex flex-column">
              <h1 class="card-title my-2 mt-md-0">{{ .Title }}</h1>
              <div class="card-text content mt-0 mb-3">
                <p>{{ .Description | default .Summary | plainify }}</p>
              </div>
              <div class="post-meta flex-grow-1 d-flex align-items-end">
                <div class="me-auto">
                  <i class="far fa-calendar fa-fw me-1"></i>
                  {{ partial "datetime.html" (dict "date" .Date) }}
                  {{ if .Params.categories }}
                    <i class="far fa-folder-open fa-fw me-1"></i>
                    <span class="categories">{{ delimit .Params.categories ", " }}</span>
                  {{ end }}
                </div>
              </div>
            </div>
          </div>
        </a>
      </article>
    {{ end }}
  </div>
  {{ end }}
{{ end }}
